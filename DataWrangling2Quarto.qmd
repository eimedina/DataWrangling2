---
title: "DataWrangling2EricPeter"
format: pdf
editor: visual
---

## #Data Wrangling 2 by Peter and Eric

```{r}
#Reading in our library
library(tidyverse)
library(here)
library(janitor)
```

##Working with whale dataset

```{r}
# Read in the data
whale_popn_wide <- read_csv(here("data/whale_popn_wide.csv"))

# Take a look at it
whale_popn_wide

## Weird `` column examples:
# Ex. Fetch the data within one column
whale_popn_wide$`Gray whale`

# Ex. Plot Gray whale abundance vs Blue whale abundance
whale_popn_wide %>% 
  ggplot(aes(x = `Gray whale`,
             y = `Blue whale`)) +
  geom_point()

#Separating columns
whale_popn_wide.sep <- whale_popn_wide %>% 
  # Separate the site_year column
  separate(col = site_year,
           # Separate into two columns in this case
           into = c("site", "year"),
           # Separate by the "_"
           sep = "_"
  )

# Now look at the data
whale_popn_wide.sep

#Making year a numeric column 
whale_popn_wide.sep <- whale_popn_wide %>% 
  # Separate the site_year column
  separate(col = site_year,
           # Separate into two columns in this case
           into = c("site", "year"),
           # Separate by the "_"
           sep = "_"
  ) %>% 
  # Run the year column through the as.numeric() function and re-store that as year
  mutate(year = as.numeric(year))

# Now look at the data
whale_popn_wide.sep

#Another method for separating columns
whale_popn_wide %>% 
  # Separate the site_year column
  separate(col = site_year,
           # Separate into two columns in this case
           into = c("site", "year"),
           # Separate by the "_"
           sep = 4
  )

#Practicing unite function

whale_popn_wide.sep %>% 
  # Unite the site and year columns back into site_year
  unite(col = site_year, # New col name is going to be site_year again
        # Add in the existing columns that we want to unite together
        site, year,
        # Separate by a comma and space this time ", "
        sep = ", "
  )

#Using pivot to turn into long format function

# Pivot to long format
whale_long <- whale_popn_wide.sep %>% 
  # Take the columns we want to pivot
  pivot_longer(cols = c(`Gray whale`, `Humpback whale`, `Blue whale`),
               # Put the column names into a column called "species"
               names_to = "species",
               # Put the cell values into a column called "population_size"
               values_to = "population_size")
# Check out the data
whale_long

#Pivoting using the column number

whale_popn_wide.sep %>% 
  pivot_longer(cols = c(4:6), # c(4:6) creates a vector of the numbers 4 through 6, aka 4, 5, 6
               names_to = "species",
               values_to = "population_size")

#Choosing columns not to pivot

# Pivot to long format
whale_popn_wide.sep %>% 
  # Specify the columns we DON'T want to pivot
  pivot_longer(cols = -c(site, year, annual_temp),
               # Put the column names into a column called "species"
               names_to = "species",
               # Put the cell values into a column called "population_size"
               values_to = "population_size")

# Or:

whale_popn_wide.sep %>% 
  # Specify we DON'T want to pivot columns 1 through 3
  pivot_longer(cols = -c(1:3), # c(1:3) creates a vector of the numbers 1 through 3, aka 1,2,3
               names_to = "species",
               values_to = "population_size")

#Now let's graph this data 

whale_long %>% 
  ggplot(aes(x = year, y = population_size, color = species)) +
  geom_point() +
  geom_line()

```

##1.4 Pivot to wide format

```{r}
#Practicing pivot_wider function 

whale_long %>%
  pivot_wider(names_from = species,
              values_from = population_size)
```

##1.5 Using group_by and summarize

```{r}
whale_long %>% arrange(species, year)

#Grouping and summarizing data by species 
whale_long %>% 
  group_by(species)

#Sumarizing our grouped data

whale_long %>% 
  group_by(species) %>% 
  summarize(mean_pop = mean(population_size))

#Removing NA's in the mean calculation

whale_long %>% 
  group_by(species) %>% 
  summarize(mean_pop = mean(population_size, na.rm = TRUE))

#Calculating standard deviation

whale_long %>% 
  group_by(species) %>% 
  summarize(mean_pop = mean(population_size, na.rm = TRUE),
            sd_pop = sd(population_size, na.rm = TRUE))

```

##Question 1..1 Which whale population is largest? Which is most variable?

### Blue whales are the largest. Gray whales are the most variable based on our data.

#Section 2

##Q2.1 Read in the data

```{r}
US_energy.wide <- read_csv("data/US_energy.wide.csv")
```

##Q2.2a What are the column names of our dataframe?

```{r}
names(US_energy.wide)
```

#### Q2.2b) What unique values are located in the "YYYYMM" column?

```{r}
unique(US_energy.wide$YYYYMM)
# lots!
```

#### Q2.2c) Are all the units in the "Unit" column the same?

```{r}

unique(US_energy.wide$unit)

# yes...

```

### Q2.3 Separate the YYYYMM column

```{r}

US_energy.wide <- 
  US_energy.wide %>% 
  clean_names() %>% 
  # have to convert YYYYMM to character to separate these
  mutate(yyyymm = as.character(yyyymm), .keep = "unused") %>% 
  relocate(yyyymm) %>% 
  separate(col = yyyymm, into = c("yyyy", "mm"), 4)

# cleaned up the variable/col names too
```

### Q2.4 Filter for proper months

```{r}
unique(US_energy.wide$mm)
# '13' might represent January...

US_energy.monthly <- 
  US_energy.wide %>% 
  filter(mm != 13)

# check
head(US_energy.monthly, 26)
```

### Q2.5 Divide the dataframe into two dataframes, representing different types of production

```{r}

# *specific* sources of energy production
specific_prod <-
  US_energy.monthly %>% 
  select(-c(8, 15, 16)) %>% 
  print(n = 15)

# *broad* (summed) sources of energy production
broad_prod <-
  US_energy.monthly %>% 
  select(c(1:3, 8, 15, 16)) %>% 
  print(n = 15)
```

### Q2.6 Pivot those dataframes!

```{r}
specific_prod.long <-
  specific_prod %>% pivot_longer(cols = c(4:13), 
                               names_to = "source",
                               values_to = "production") %>% 
  select(-unit) # don't need/want this variable anymore

broad_prod.long <-
  broad_prod %>% pivot_longer(cols = c(4:6),
                              names_to = "source",
                              values_to = "production") %>% 
  select(-unit) # don't need/want this variable anymore

# quick check
head(specific_prod.long)
head(broad_prod.long)
```

### Q2.7 Summarize by year and energy source

```{r}
specific_prod_yearly <-
  specific_prod.long %>% 
  group_by(yyyy, source) %>% 
  summarise(annual_production = sum(production)) %>% 
  mutate(yyyy = as.integer(yyyy),
         source = as.factor(source))

broad_prod_yearly <- 
  broad_prod.long %>% 
  group_by(yyyy, source) %>% 
  summarise(annual_production = sum(production)) %>% 
  mutate(yyyy = as.integer(yyyy),
         source = as.factor(source))

# check!
specific_prod_yearly
broad_prod_yearly
```

### Q2.8 Plot broad energy production over time

```{r}
# Calvin noted that there was a prob w the data for 2020, so let's end the time series at 2019

# generate basic line plot...but what is the primary energy production? I changed this to primary fuels but don't think this is correct
p <-
  broad_prod_yearly %>% 
  filter(yyyy < 2020) %>%
  ggplot(aes(yyyy, annual_production, color = source)) + 
  geom_line()

# add details...
p + 
  xlab("year") +
  ylab("annual production (quadrillion BTUs)") +
  labs(color = "energy source") +
  scale_color_manual(values = c("darkred", "darkgreen", "darkblue"),
                     labels = 
                        c("fossil fuels", "primary fuels", "renewable technologies")) +
  theme_bw()
```

#### In the United States annual energy production has been increasing over time. This is true for both renewable and fossil fuels, though fossil fuel energy production has been growing at a faster rate. 

### Q2.9 Plot the production of specific energy sources over type

```{r}
p2 <-
  specific_prod_yearly %>% 
  filter(yyyy < 2020) %>%
  ggplot(aes(yyyy, annual_production, color = source)) + 
  geom_line()

# add details...
p2 + 
  xlab("year") +
  ylab("annual production (quadrillion BTUs)") +
  labs(color = "source") +
  scale_color_discrete(
    labels = c(
      "biomass_energy_production" = "biomass",
      "coal_production" = "coal",
      "crude_oil_production" = "crude oil",
      "geothermal_energy_production" = "geothermal energy",
      "hydroelectric_power_production" = "hydroelectric",
      "natural_gas_dry_production" = "natural gas dry",
      "natural_gas_plant_liquids_production" = "natural gas liquid",
      "nuclear_electric_power_production" = "nuclear electric",
      "solar_energy_production" = "solar energy",
      "wind_energy_production" = "wind energy"
    )
  ) +
  theme_bw()


```

#### In the past \~45 years there have been many changes in energy production in the United States. The most produced sources include crude oil, coal, and natural gas dry. In 2010 coal production has lowered while natural gas and crude oil production have had steep growth since 2010. 
